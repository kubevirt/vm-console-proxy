apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - config_map.yaml
  - service_account.yaml
  - role.yaml
  - role_binding.yaml
  - service.yaml
  - deployment.yaml
  - api_service.yaml
  - user_role.yaml

transformers:
  - transformer_namespace.yaml

images:
  - name: console
    newName: ${IMG_REPOSITORY}
    newTag: ${IMG_TAG}

patches:
  - target:
      kind: Deployment
      name: vm-console-proxy
    patch: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: vm-console-proxy
      spec:
        template:
          spec:
            containers:
              - name: console
                imagePullPolicy: ${IMG_PULL_POLICY}